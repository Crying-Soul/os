#!/bin/bash

# Файлы с ограничениями IPC и их описания
declare -A IPC_INFO=(
    ["/proc/sys/kernel/msgmax"]="Максимальный размер одного сообщения в очереди (в байтах). Например, 8192 = 8 КБ."
    ["/proc/sys/kernel/msgmnb"]="Максимальный размер одной очереди сообщений (в байтах). Например, 16384 = 16 КБ."
    ["/proc/sys/kernel/msgmni"]="Максимальное количество очередей сообщений в системе. Например, 32000."
    ["/proc/sys/kernel/shmmax"]="Максимальный размер сегмента shared memory (в байтах). Например, 18446744073692774399 = 16 эксабайт (практически не ограничено)."
    ["/proc/sys/kernel/shmall"]="Общий объем shared memory, который может быть выделен (в страницах памяти). Например, 4294967296 = 16 ТБ (при размере страницы 4 КБ)."
    ["/proc/sys/kernel/sem"]="Параметры семафоров в формате: [1]макс. семафоров в системе [2]макс. операций за вызов [3]макс. системных семафоров [4]макс. очередей семафоров."
)

echo "=== Текущие ограничения IPC в системе ==="
echo "Все пути указаны в абсолютном формате (/proc/sys/kernel/...)"
echo "----------------------------------------"

for file in "${!IPC_INFO[@]}"; do
    if [[ -f "$file" ]]; then
        echo "● Путь: $file"
        echo "  Значение: $(cat "$file")"
        echo "  Описание: ${IPC_INFO[$file]}"
        echo "----------------------------------------"
    else
        echo "⚠ Файл $file не найден!" >&2
    fi

done


strace -f -e trace=ipc,msgget,msgsnd,msgrcv,msgctl ./lb3/6/6.3/message_queue
